import web
import os
import MySQLdb,sys
import time	

urls = ('/upload', 'Upload')
filedir="/home/muc/Desktop/temp/"
connection = MySQLdb.Connect(host='', user='root', passwd='password', db='smart_meter',local_infile = 1)
cursor = connection.cursor()
folders=os.listdir(filedir)
for folder in folders:
	list_of_files=glob.glob(str(filedir)+str(folder)+str("/*.csv"))
        	for f in list_of_files: 
			time.sleep(.1)
			try:
				query = "LOAD DATA LOCAL INFILE "+"'"+f+"'"+" INTO TABLE smart_meter_data FIELDS TERMINATED BY ','  IGNORE 1 LINES"			
				print query
				cursor.execute(query)
				connection.commit()
				
				os.remove(f)

			except Exception,e:
				print e
			
 
